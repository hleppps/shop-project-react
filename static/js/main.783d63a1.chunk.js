(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},102:function(e,t,n){},111:function(e,t,n){},113:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var a,o,r,i,l,c,s,u,d,m=n(4),p=n(132),g=n(55),h=n(133),f=n(134),v=n(129),b=n(130),E=n(0),j=n.n(E),O=n(31),w=n.n(O),y=n(136),P=n(9),S=n(104),F=n(123),I=n(138),C=n(83),k=n(135),N=n(137),A=n(19),_=n(131),L=Object(_.a)(a||(a=Object(A.a)(["\n  mutation UpdateUserStatus($userStatus: String!) {\n    updateStatus(status: $userStatus) {\n      status\n    }\n  }\n"]))),$=Object(_.a)(o||(o=Object(A.a)(["\n  mutation CreateNewPost(\n    $title: String!\n    $content: String!\n    $imageUrl: String!\n  ) {\n    createPost(\n      postInput: { title: $title, content: $content, imageUrl: $imageUrl }\n    ) {\n      _id\n      title\n      content\n      imageUrl\n      creator {\n        name\n      }\n      createdAt\n    }\n  }\n"]))),U=Object(_.a)(r||(r=Object(A.a)(["\n  mutation UpdateExistingPost(\n    $postId: ID!\n    $title: String!\n    $content: String!\n    $imageUrl: String!\n  ) {\n    updatePost(\n      id: $postId\n      postInput: { title: $title, content: $content, imageUrl: $imageUrl }\n    ) {\n      _id\n      title\n      content\n      imageUrl\n      creator {\n        name\n      }\n      createdAt\n    }\n  }\n"]))),B=Object(_.a)(i||(i=Object(A.a)(["\n  mutation DeletePost($postId: ID!) {\n    deletePost(id: $postId)\n  }\n"]))),D=Object(_.a)(l||(l=Object(A.a)(["\n  mutation CreateNewUser($email: String!, $name: String!, $password: String!) {\n    createUser(userInput: { email: $email, name: $name, password: $password }) {\n      _id\n      email\n    }\n  }\n"]))),x=Object(_.a)(c||(c=Object(A.a)(["\n  query FetchSinglePost($postId: ID!) {\n    post(id: $postId) {\n      title\n      content\n      imageUrl\n      creator {\n        name\n      }\n      createdAt\n    }\n  }\n"]))),H=Object(_.a)(s||(s=Object(A.a)(["\n  query GetStatus {\n    user {\n      status\n    }\n  }\n"]))),M=Object(_.a)(u||(u=Object(A.a)(["\n  query FetchPosts($page: Int) {\n    posts(page: $page) {\n      posts {\n        _id\n        title\n        content\n        imageUrl\n        creator {\n          name\n        }\n        createdAt\n      }\n      totalPosts\n    }\n  }\n"]))),T=Object(_.a)(d||(d=Object(A.a)(["\n  query UserLogin($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n      userId\n    }\n  }\n"]))),V=(n(64),n(66),function(e){return w.a.createPortal(j.a.createElement("div",{className:["backdrop",e.open?"open":""].join(" "),onClick:e.onClick}),document.getElementById("backdrop-root"))}),z=n(70),q=(n(68),function(e){return e.link?j.a.createElement(z.a,{className:["button","button--".concat(e.design),"button--".concat(e.mode)].join(" "),to:e.link},e.children):j.a.createElement("button",{className:["button","button--".concat(e.design),"button--".concat(e.mode)].join(" "),onClick:e.onClick,disabled:e.disabled||e.loading,type:e.type},e.loading?"Loading...":e.children)}),Y=(n(73),function(e){return w.a.createPortal(j.a.createElement("div",{className:"modal"},j.a.createElement("header",{className:"modal__header"},j.a.createElement("h1",null,e.title)),j.a.createElement("div",{className:"modal__content"},e.children),j.a.createElement("div",{className:"modal__actions"},j.a.createElement(q,{design:"danger",mode:"flat",onClick:e.onCancelModal},"Cancel"),j.a.createElement(q,{mode:"raised",onClick:e.onAcceptModal,disabled:!e.acceptEnabled,loading:e.isLoading},"Accept"))),document.getElementById("modal-root"))}),J=function(e){return j.a.createElement(E.Fragment,null,e.error&&j.a.createElement(V,{onClick:e.onHandle}),e.error&&j.a.createElement(Y,{title:"An Error Occurred",onCancelModal:e.onHandle,onAcceptModal:e.onHandle,acceptEnabled:!0},j.a.createElement("p",null,e.error.message)))},R=(n(75),function(e){return j.a.createElement(E.Fragment,null,j.a.createElement("header",{className:"main-header"},e.header),e.mobileNav,j.a.createElement("main",{className:"content"},e.children))}),G=n(120),K=(n(77),function(e){return j.a.createElement("button",{className:"mobile-toggle",onClick:e.onOpen},j.a.createElement("span",{className:"mobile-toggle__bar"}),j.a.createElement("span",{className:"mobile-toggle__bar"}),j.a.createElement("span",{className:"mobile-toggle__bar"}))}),Q=(n(79),function(e){return j.a.createElement("h1",{className:"logo"},"MessageNode")}),W=n(25),X=(n(81),[{id:"feed",text:"Feed",link:"/",auth:!0},{id:"login",text:"Login",link:"/",auth:!1},{id:"signup",text:"Signup",link:"/signup",auth:!1}]),Z=function(e){return[].concat(Object(W.a)(X.filter(function(t){return t.auth===e.isAuth}).map(function(t){return j.a.createElement("li",{key:t.id,className:["navigation-item",e.mobile?"mobile":""].join(" ")},j.a.createElement(G.a,{to:t.link,exact:!0,onClick:e.onChoose},t.text))})),[e.isAuth&&j.a.createElement("li",{className:"navigation-item",key:"logout"},j.a.createElement("button",{onClick:e.onLogout},"Logout"))])},ee=(n(85),function(e){return j.a.createElement("nav",{className:"main-nav"},j.a.createElement(K,{onOpen:e.onOpenMobileNav}),j.a.createElement("div",{className:"main-nav__logo"},j.a.createElement(G.a,{to:"/"},j.a.createElement(Q,null))),j.a.createElement("div",{className:"spacer"}),j.a.createElement("ul",{className:"main-nav__items"},j.a.createElement(Z,{isAuth:e.isAuth,onLogout:e.onLogout})))}),te=(n(87),function(e){return j.a.createElement("nav",{className:["mobile-nav",e.open?"open":""].join(" ")},j.a.createElement("ul",{className:["mobile-nav__items",e.mobile?"mobile":""].join(" ")},j.a.createElement(Z,{mobile:!0,onChoose:e.onChooseItem,isAuth:e.isAuth,onLogout:e.onLogout})))}),ne=(n(89),function(e){return j.a.createElement("div",{className:"toolbar"},e.children)}),ae=n(18),oe=n(10),re=n(11),ie=n(27),le=n(21),ce=n(26),se=(n(50),function(e){return j.a.createElement("div",{className:"input"},e.label&&j.a.createElement("label",{htmlFor:e.id},e.label),"input"===e.control&&j.a.createElement("input",{className:[e.valid?"valid":"invalid",e.touched?"touched":"untouched"].join(" "),type:e.type,id:e.id,required:e.required,value:e.value,placeholder:e.placeholder,onChange:function(t){return e.onChange(e.id,t.target.value,t.target.files)},onBlur:e.onBlur}),"textarea"===e.control&&j.a.createElement("textarea",{className:[e.valid?"valid":"invalid",e.touched?"touched":"untouched"].join(" "),id:e.id,rows:e.rows,required:e.required,value:e.value,onChange:function(t){return e.onChange(e.id,t.target.value)},onBlur:e.onBlur}))}),ue=function(e){return""!==e.trim()},de=function(e){return function(t){var n=!0;return e.min&&(n=n&&t.trim().length>=e.min),e.max&&(n=n&&t.trim().length<=e.max),n}},me=function(e){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)},pe=(n(92),function(e){return j.a.createElement("section",{className:"auth-form"},e.children)});function ge(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw r}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var fe=function(e){function t(){var e,n;Object(oe.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(ie.a)(this,(e=Object(le.a)(t)).call.apply(e,[this].concat(o)))).state={loginForm:{email:{value:"",valid:!1,touched:!1,validators:[ue,me]},password:{value:"",valid:!1,touched:!1,validators:[ue,de({min:5})]},formIsValid:!1}},n.inputChangeHandler=function(e,t){n.setState(function(n){var a,o=!0,r=ge(n.loginForm[e].validators);try{for(r.s();!(a=r.n()).done;){var i=a.value;o=o&&i(t)}}catch(u){r.e(u)}finally{r.f()}var l=Object(m.a)({},n.loginForm,Object(ae.a)({},e,Object(m.a)({},n.loginForm[e],{valid:o,value:t}))),c=!0;for(var s in l)c=c&&l[s].valid;return{loginForm:l,formIsValid:c}})},n.inputBlurHandler=function(e){n.setState(function(t){return{loginForm:Object(m.a)({},t.loginForm,Object(ae.a)({},e,Object(m.a)({},t.loginForm[e],{touched:!0})))}})},n}return Object(ce.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this;return j.a.createElement(pe,null,j.a.createElement("form",{onSubmit:function(t){return e.props.onLogin(t,{email:e.state.loginForm.email.value,password:e.state.loginForm.password.value})}},j.a.createElement(se,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.loginForm.email.value,valid:this.state.loginForm.email.valid,touched:this.state.loginForm.email.touched}),j.a.createElement(se,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.loginForm.password.value,valid:this.state.loginForm.password.valid,touched:this.state.loginForm.password.touched}),j.a.createElement(q,{design:"raised",type:"submit",loading:this.props.loading},"Login")))}}]),t}(E.Component);function ve(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw r}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ee=function(e){function t(){var e,n;Object(oe.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(ie.a)(this,(e=Object(le.a)(t)).call.apply(e,[this].concat(o)))).state={signupForm:{email:{value:"",valid:!1,touched:!1,validators:[ue,me]},password:{value:"",valid:!1,touched:!1,validators:[ue,de({min:5})]},name:{value:"",valid:!1,touched:!1,validators:[ue]},formIsValid:!1}},n.inputChangeHandler=function(e,t){n.setState(function(n){var a,o=!0,r=ve(n.signupForm[e].validators);try{for(r.s();!(a=r.n()).done;){var i=a.value;o=o&&i(t)}}catch(u){r.e(u)}finally{r.f()}var l=Object(m.a)({},n.signupForm,Object(ae.a)({},e,Object(m.a)({},n.signupForm[e],{valid:o,value:t}))),c=!0;for(var s in l)c=c&&l[s].valid;return{signupForm:l,formIsValid:c}})},n.inputBlurHandler=function(e){n.setState(function(t){return{signupForm:Object(m.a)({},t.signupForm,Object(ae.a)({},e,Object(m.a)({},t.signupForm[e],{touched:!0})))}})},n}return Object(ce.a)(t,e),Object(re.a)(t,[{key:"render",value:function(){var e=this;return j.a.createElement(pe,null,j.a.createElement("form",{onSubmit:function(t){return e.props.onSignup(t,e.state)}},j.a.createElement(se,{id:"email",label:"Your E-Mail",type:"email",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"email"),value:this.state.signupForm.email.value,valid:this.state.signupForm.email.valid,touched:this.state.signupForm.email.touched}),j.a.createElement(se,{id:"name",label:"Your Name",type:"text",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"name"),value:this.state.signupForm.name.value,valid:this.state.signupForm.name.valid,touched:this.state.signupForm.name.touched}),j.a.createElement(se,{id:"password",label:"Password",type:"password",control:"input",onChange:this.inputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"password"),value:this.state.signupForm.password.value,valid:this.state.signupForm.password.valid,touched:this.state.signupForm.password.touched}),j.a.createElement(q,{design:"raised",type:"submit",loading:this.props.loading},"Signup")))}}]),t}(E.Component),je=n(121),Oe=function(e){return j.a.createElement("div",{className:"input"},j.a.createElement("label",{htmlFor:e.id},e.label),j.a.createElement("input",{className:[e.valid?"valid":"invalid",e.touched?"touched":"untouched"].join(" "),type:"file",id:e.id,onChange:function(t){return e.onChange(e.id,t.target.value,t.target.files)},onBlur:e.onBlur}))},we=(n(94),function(e){return j.a.createElement("div",{className:"image",style:{backgroundImage:"url('".concat(e.imageUrl,"')"),backgroundSize:e.contain?"contain":"cover",backgroundPosition:e.left?"left":"center"}})}),ye=function(e){var t=new FileReader,n=new Promise(function(e,n){t.onload=function(t){return e(t.target.result)},t.onerror=function(e){return n(e)}});return t.readAsDataURL(e),n};function Pe(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return Se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Se(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw r}}}}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Fe={title:{value:"",valid:!1,touched:!1,validators:[ue,de({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[ue]},content:{value:"",valid:!1,touched:!1,validators:[ue,de({min:5})]}},Ie=function(e){function t(){var e,n;Object(oe.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(ie.a)(this,(e=Object(le.a)(t)).call.apply(e,[this].concat(o)))).state={postForm:Fe,formIsValid:!1,imagePreview:null},n.postInputChangeHandler=function(e,t,a){a&&ye(a[0]).then(function(e){n.setState({imagePreview:e})}).catch(function(e){n.setState({imagePreview:null})}),n.setState(function(n){var o,r=!0,i=Pe(n.postForm[e].validators);try{for(i.s();!(o=i.n()).done;){var l=o.value;r=r&&l(t)}}catch(d){i.e(d)}finally{i.f()}var c=Object(m.a)({},n.postForm,Object(ae.a)({},e,Object(m.a)({},n.postForm[e],{valid:r,value:a?a[0]:t}))),s=!0;for(var u in c)s=s&&c[u].valid;return{postForm:c,formIsValid:s}})},n.inputBlurHandler=function(e){n.setState(function(t){return{postForm:Object(m.a)({},t.postForm,Object(ae.a)({},e,Object(m.a)({},t.postForm[e],{touched:!0})))}})},n.cancelPostChangeHandler=function(){n.setState({postForm:Fe,formIsValid:!1}),n.props.onCancelEdit()},n.acceptPostChangeHandler=function(){var e={title:n.state.postForm.title.value,image:n.state.postForm.image.value,content:n.state.postForm.content.value};n.props.onFinishEdit(e),n.setState({postForm:Fe,formIsValid:!1,imagePreview:null})},n}return Object(ce.a)(t,e),Object(re.a)(t,[{key:"componentDidUpdate",value:function(e,t){if(this.props.editing&&e.editing!==this.props.editing&&e.selectedPost!==this.props.selectedPost){var n={title:Object(m.a)({},t.postForm.title,{value:this.props.selectedPost.title,valid:!0}),image:Object(m.a)({},t.postForm.image,{value:this.props.selectedPost.imagePath,valid:!0}),content:Object(m.a)({},t.postForm.content,{value:this.props.selectedPost.content,valid:!0})};this.setState({postForm:n,formIsValid:!0})}}},{key:"render",value:function(){return this.props.editing?j.a.createElement(E.Fragment,null,j.a.createElement(V,{onClick:this.cancelPostChangeHandler}),j.a.createElement(Y,{title:"New Post",acceptEnabled:this.state.formIsValid,onCancelModal:this.cancelPostChangeHandler,onAcceptModal:this.acceptPostChangeHandler,isLoading:this.props.loading},j.a.createElement("form",null,j.a.createElement(se,{id:"title",label:"Title",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"title"),valid:this.state.postForm.title.valid,touched:this.state.postForm.title.touched,value:this.state.postForm.title.value}),j.a.createElement(Oe,{id:"image",label:"Image",control:"input",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"image"),valid:this.state.postForm.image.valid,touched:this.state.postForm.image.touched}),j.a.createElement("div",{className:"new-post__preview-image"},!this.state.imagePreview&&j.a.createElement("p",null,"Please choose an image."),this.state.imagePreview&&j.a.createElement(we,{imageUrl:this.state.imagePreview,contain:!0,left:!0})),j.a.createElement(se,{id:"content",label:"Content",control:"textarea",rows:"5",onChange:this.postInputChangeHandler,onBlur:this.inputBlurHandler.bind(this,"content"),valid:this.state.postForm.content.valid,touched:this.state.postForm.content.touched,value:this.state.postForm.content.value})))):null}}]),t}(E.Component),Ce=(n(96),function(e){return j.a.createElement("article",{className:"post"},j.a.createElement("header",{className:"post__header"},j.a.createElement("h3",{className:"post__meta"},"Posted by ",e.author," on ",e.date),j.a.createElement("h1",{className:"post__title"},e.title)),j.a.createElement("div",{className:"post__actions"},j.a.createElement(q,{mode:"flat",link:e.id},"View"),j.a.createElement(q,{mode:"flat",onClick:e.onStartEdit},"Edit"),j.a.createElement(q,{mode:"flat",design:"danger",onClick:e.onDelete},"Delete")))}),ke=(n(98),function(e){return j.a.createElement("div",{className:"loader"},j.a.createElement("div",null),j.a.createElement("div",null),j.a.createElement("div",null),j.a.createElement("div",null))}),Ne=(n(100),function(e){return j.a.createElement("div",{className:"paginator"},e.children,j.a.createElement("div",{className:"paginator__controls"},e.currentPage>1&&j.a.createElement("button",{className:"paginator__control",onClick:e.onPrevious},"Previous"),e.currentPage<e.lastPage&&j.a.createElement("button",{className:"paginator__control",onClick:e.onNext},"Next")))}),Ae=(n(102),Object(N.a)(function(e){var t=Object(E.useState)({isEditing:!1,posts:[],totalPosts:0,editPost:null,status:"",postPage:1,postsLoading:!0,editLoading:!1}),n=Object(P.a)(t,2),a=n[0],o=n[1],r=Object(je.a)(H),i=Object(P.a)(r,1)[0],l=Object(S.a)(M,{variables:{page:1}}),c=Object(F.a)(L),s=Object(P.a)(c,1)[0],u=Object(F.a)($),d=Object(P.a)(u,1)[0],p=Object(F.a)(U),g=Object(P.a)(p,1)[0],h=Object(F.a)(B),f=Object(P.a)(h,1)[0];Object(E.useEffect)(function(){i().then(function(e){e.error&&(localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId"),window.location.reload()),o(function(t){return Object(m.a)({},t,{status:e.data.user.status})})}).catch(b),v()},[]);var v=function(e){e&&o(function(e){return Object(m.a)({},e,{postsLoading:!0,posts:[]})});var t=a.postPage;"next"===e&&t++,"previous"===e&&t--,o(function(e){return Object(m.a)({},e,{postPage:t})}),l.refetch({page:t}).then(function(e){if(console.log("LOADED POSTS",e.data.posts.totalPosts),e.errors)throw new Error("Fetching posts failed!");o(function(t){return Object(m.a)({},t,{posts:e.data.posts.posts.map(function(e){return Object(m.a)({},e,{imagePath:e.imageUrl})}),totalPosts:e.data.posts.totalPosts,postsLoading:!1})})}).catch(function(e){console.log(e)})},b=function(e){o(function(t){return Object(m.a)({},t,{error:e})})};return j.a.createElement(E.Fragment,null,j.a.createElement(J,{error:a.error,onHandle:function(){o(function(e){return Object(m.a)({},e,{error:null})})}}),j.a.createElement(Ie,{editing:a.isEditing,selectedPost:a.editPost,loading:a.editLoading,onCancelEdit:function(){o(function(e){return Object(m.a)({},e,{isEditing:!1,editPost:null})})},onFinishEdit:function(t){o(function(e){return Object(m.a)({},e,{editLoading:!0})});var n=new FormData;n.append("image",t.image),a.editPost&&n.append("oldPath",a.editPost.imagePath),fetch("http://localhost:8080/post-image",{method:"PUT",headers:{Authorization:"Bearer "+e.token},body:n}).then(function(e){return e.json()}).then(function(e){var n=e.filePath||"undefined";n&&(n=n.replace(/\\/g,"/"));var o=d,r={title:t.title,content:t.content,imageUrl:n};return a.editPost&&(o=g,r={postId:a.editPost._id,title:t.title,content:t.content,imageUrl:n}),{mutation:o,variables:r}}).then(function(e){return(0,e.mutation)({variables:e.variables})}).then(function(e){if(e.errors&&422===e.errors[0].status)throw new Error("Validation failed. Make sure the email address and/or are valid!");if(e.errors)throw new Error("Post creation failed!");console.log(e);var t="createPost";a.editPost&&(t="updatePost");var n={_id:e.data[t]._id,title:e.data[t].title,content:e.data[t].content,creator:e.data[t].creator,createdAt:e.data[t].createdAt,imagePath:e.data[t].imageUrl};o(function(e){var t=Object(W.a)(e.posts),a=e.totalPosts;return e.editPost?t[e.posts.findIndex(function(t){return t._id===e.editPost._id})]=n:(a++,e.posts.length>=2&&t.pop(),t.unshift(n)),Object(m.a)({},e,{posts:t,isEditing:!1,editPost:null,editLoading:!1,totalPosts:a})})}).catch(function(e){console.log(e),o(function(t){return Object(m.a)({},t,{isEditing:!1,editPost:null,editLoading:!1,error:e})})})}}),j.a.createElement("section",{className:"feed__status"},j.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s({variables:{userStatus:a.status}}).then(function(e){if(e.errors)throw new Error("Fetching status failed!");console.log(e)}).catch(b)}},j.a.createElement(se,{type:"text",placeholder:"Your status",control:"input",onChange:function(e,t){o(function(e){return Object(m.a)({},e,{status:t})})},value:a.status}),j.a.createElement(q,{mode:"flat",type:"submit"},"Update"))),j.a.createElement("section",{className:"feed__control"},j.a.createElement(q,{mode:"raised",design:"accent",onClick:function(){o(function(e){return Object(m.a)({},e,{isEditing:!0})})}},"New Post")),j.a.createElement("section",{className:"feed"},a.postsLoading&&j.a.createElement("div",{style:{textAlign:"center",marginTop:"2rem"}},j.a.createElement(ke,null)),a.posts.length<=0&&!a.postsLoading?j.a.createElement("p",{style:{textAlign:"center"}},"No posts found."):null,!a.postsLoading&&j.a.createElement(Ne,{onPrevious:function(){v("previous")},onNext:function(){v("next")},lastPage:Math.ceil(a.totalPosts/2),currentPage:a.postPage},a.posts.map(function(e){return j.a.createElement(Ce,{key:e._id,id:e._id,author:e.creator.name,date:new Date(e.createdAt).toLocaleDateString("en-US"),title:e.title,image:e.imageUrl,content:e.content,onStartEdit:function(){var t;t=e._id,o(function(e){return Object(m.a)({},e,{isEditing:!0,editPost:Object(m.a)({},e.posts.find(function(e){return e._id===t}))})})},onDelete:function(){var t;t=e._id,o(function(e){return Object(m.a)({},e,{postsLoading:!0})}),f({variables:{postId:t}}).then(function(e){if(e.errors)throw new Error("Deleting the post failed!");console.log("POST DELETED:",e),v()}).catch(function(e){console.log(e),o(function(t){return Object(m.a)({},t,{postsLoading:!1,error:e})})})}})}))))})),_e=(n(111),function(e){var t=e.match.params.postId,n=Object(S.a)(x,{variables:{postId:t}}),a=n.loading,o=n.error,r=n.data;if(a)return j.a.createElement("h2",null,"Loading...");if(o)throw new Error("Fetching post failed!");var i=r.post.title,l=r.post.creator.name,c=new Date(r.post.createdAt).toLocaleDateString("en-US"),s="http://localhost:8080/"+r.post.imageUrl,u=r.post.content;return j.a.createElement("section",{className:"single-post"},j.a.createElement("h1",null,i),j.a.createElement("h2",null,"Created by ",l," on ",new Date(c).toLocaleDateString("en-US")),j.a.createElement("div",{className:"single-post__image"},j.a.createElement(we,{contain:!0,imageUrl:s})),j.a.createElement("p",null,u))}),Le=Object(N.a)(function(e){var t=Object(E.useState)({showMobileNav:!1,showBackdrop:!1,error:null,isAuth:!1,token:null,userId:null,authLoading:!1}),n=Object(P.a)(t,2),a=n[0],o=n[1],r=Object(S.a)(T,{variables:{email:"",password:""}}),i=Object(F.a)(D),l=Object(P.a)(i,1)[0];Object(E.useEffect)(function(){var e=localStorage.getItem("token"),t=localStorage.getItem("expiryDate");if(e&&t)if(new Date(t)<=new Date)s();else{var n=localStorage.getItem("userId"),a=new Date(t).getTime()-(new Date).getTime();o(function(t){return Object(m.a)({},t,{isAuth:!0,token:e,userId:n})}),p(a)}},[]);var c=function(e){o(function(t){return Object(m.a)({},t,{showMobileNav:e,showBackdrop:e})})},s=function(){o(function(e){return Object(m.a)({},e,{isAuth:!1,token:null})}),localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId")},u=function(e,t){e.preventDefault(),o(function(e){return Object(m.a)({},e,{authLoading:!0})}),r.refetch({email:t.email,password:t.password}).then(function(e){o(function(t){return Object(m.a)({},t,{isAuth:!0,token:e.data.login.token,authLoading:!1,userId:e.data.login.userId})}),localStorage.setItem("token",e.data.login.token),localStorage.setItem("userId",e.data.login.userId);var t=new Date((new Date).getTime()+36e5);localStorage.setItem("expiryDate",t.toISOString()),p(36e5)}).catch(function(e){console.log(e.code),o(function(t){return Object(m.a)({},t,{isAuth:!1,authLoading:!1,error:e})})})},d=function(t,n){t.preventDefault(),o(function(e){return Object(m.a)({},e,{authLoading:!0})}),l({variables:{email:n.signupForm.email.value,name:n.signupForm.name.value,password:n.signupForm.password.value}}).then(function(t){if(t.errors&&422===t.errors[0].status)throw new Error("Validation failed. Make sure the email address isn't used yet!");if(t.errors)throw new Error("User creation failed!");console.log(t),o(function(e){return Object(m.a)({},e,{isAuth:!1,authLoading:!1})}),e.history.replace("/")}).catch(function(e){console.log(e),o(function(t){return Object(m.a)({},t,{isAuth:!1,authLoading:!1,error:e})})})},p=function(e){setTimeout(function(){s()},e)},g=j.a.createElement(I.a,null,j.a.createElement(C.a,{path:"/",exact:!0,render:function(e){return j.a.createElement(fe,Object.assign({},e,{onLogin:u,loading:a.authLoading}))}}),j.a.createElement(C.a,{path:"/signup",exact:!0,render:function(e){return j.a.createElement(Ee,Object.assign({},e,{onSignup:d,loading:a.authLoading}))}}),j.a.createElement(k.a,{to:"/"}));return a.isAuth&&(g=j.a.createElement(I.a,null,j.a.createElement(C.a,{path:"/",exact:!0,render:function(e){return j.a.createElement(Ae,{userId:a.userId,token:a.token})}}),j.a.createElement(C.a,{path:"/:postId",render:function(e){return j.a.createElement(_e,Object.assign({},e,{userId:a.userId,token:a.token}))}}),j.a.createElement(k.a,{to:"/"}))),j.a.createElement(E.Fragment,null,a.showBackdrop&&j.a.createElement(V,{onClick:function(){o(function(e){return Object(m.a)({},e,{showMobileNav:!1,showBackdrop:!1,setError:null})})}}),j.a.createElement(J,{error:a.error,onHandle:function(){o(function(e){return Object(m.a)({},e,{error:null})})}}),j.a.createElement(R,{header:j.a.createElement(ne,null,j.a.createElement(ee,{onOpenMobileNav:function(){c(!0)},onLogout:s,isAuth:a.isAuth})),mobileNav:j.a.createElement(te,{open:a.showMobileNav,mobile:!0,onChooseItem:function(){c(!1)},onLogout:s,isAuth:a.isAuth})}),g)}),$e=(n(113),new p.a({uri:"https://hleppps-nodejs-blog.herokuapp.com/graphql"})),Ue=new g.a(function(e,t){return e.setContext(function(e){var t=e.headers,n=void 0===t?{}:t;return{headers:Object(m.a)({},n,{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")||null})}}),t(e)}),Be=new h.a({cache:new f.a,link:Object(v.a)(Ue,$e),defaultOptions:{query:{fetchPolicy:"network-only"}}});w.a.render(j.a.createElement(b.a,{client:Be},j.a.createElement(y.a,null,j.a.createElement(Le,null))),document.getElementById("root"))},50:function(e,t,n){},59:function(e,t,n){e.exports=n(115)},64:function(e,t,n){},66:function(e,t,n){},68:function(e,t,n){},73:function(e,t,n){},75:function(e,t,n){},77:function(e,t,n){},79:function(e,t,n){},81:function(e,t,n){},85:function(e,t,n){},87:function(e,t,n){},89:function(e,t,n){},92:function(e,t,n){},94:function(e,t,n){},96:function(e,t,n){},98:function(e,t,n){}},[[59,2,1]]]);
//# sourceMappingURL=main.783d63a1.chunk.js.map